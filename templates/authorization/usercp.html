{% extends "base.html" %} 

{% block base_content %}
    <h1>Сервисы</h1>
    <p>Вы можете входить в свой аккаунт, используя различные социальные сервисы.</p>

    <h2>Основной сервис</h2>
    <div style="margin: 10px 0;">
        <div style="float: left; margin-right: 10px;">
            <img src="/asset/img/social_service/{{ default_identity.service }}/145x45.png" />
        </div>
        <div style="float: left;">
            <div class="identity">
                <a href="#" class="avatar"><img src="{{ default_identity|identity_avatar|internet_image("_/24") }}"></a>
                <a href="{{ default_identity|identity_url }}" class="username">{{ default_identity|identity_name }}</a>
            </div>
        </div>
        <div class="clear"></div>
    </div>

    {% if attached_identities %}
        <h2>Привязанные сервисы</h2>
        {% for identity in attached_identities %}
            <div style="margin: 10px 0;">
                <div style="float: left; margin-right: 10px;">
                    <img src="/asset/img/social_service/{{ identity.service }}/145x45.png" />
                </div>
                <div style="float: left;">
                    <div class="identity">
                        <a href="#" class="avatar"><img src="{{ identity|identity_avatar|internet_image("_/24") }}"></a>
                        <a href="{{ identity|identity_url }}" class="username">{{ identity|identity_name }}</a>
                        <div class="clear"></div>

                        <div style="margin-top: 2px;">
                            <form action="/authorization/set-default-identity/" method="post">
                                <input type="hidden" name="id" value="{{ identity.id }}" />
                                <a href="#" style="font-size: 12px; text-decoration: underline;" onclick="$(this).parent().submit(); return false;">Сделать основным</a>
                            </form>
                        </div>
                    </div>
                </div>
                <div class="clear"></div>
            </div>
        {% endfor %}
    {% endif %}

    {% if available_services %}
        <h2>Доступные сервисы</h2>
        {% for service in available_services %}
            <div style="margin: 10px 0;">
                <a href="/authorization/{{ service }}/initiate/"><img src="/asset/img/social_service/{{ service }}/145x45.png" /></a>
            </div>
        {% endfor %}
    {% endif %}

    {% if settings %}
        <h1>Настройки</h1>
        <form action="/authorization/save-settings/" class="user-settings" method="post">
            {% for setting in settings %}
                <div class="setting {{ setting.class }}">
                    {{ setting.html }}
                </div>
            {% endfor %}
            <input type="submit" value="Сохранить" />
        </form>
    {% endif %}

    {% if present_hardware %}
        <ul class="present-hardware">
            {% for hardware in present_hardware %}
                <li data-mac="{{ hardware.mac }}">
                    <span class="mac">{{ hardware.mac }}</span>
                    {% if hardware.hostname %}
                        ({{ hardware.hostname }})
                    {% endif %}
                    с {{ hardware.start|datetime }}
                </li>
            {% endfor %}
        </ul>

        <script type="text/javascript">
            $(function(){
                var $pageContent = $(".page-content");
                var $macInput = $("#MacAddress input");
                var $presentHardware = $(".present-hardware");
                var $dropdownHandle = $("<div/>").addClass("dropdown-handle")
                                                 .css("paddingTop", "10px")
                                                 .css("paddingBottom", "10px")
                                                 .css("paddingLeft", "5px")
                                                 .css("paddingRight", "5px")
                                                 .appendTo($("body"));

                $dropdownHandle.css("position", "absolute")
                               .css("top", $pageContent.position().top + $macInput.position().top + 4)
                               .css("left", $macInput.position().left + $macInput.width())
                               .click(function(){ $presentHardware.fadeToggle(200); });

                $presentHardware.css("position", "absolute")
                                .css("top", $pageContent.position().top + $macInput.position().top + $macInput.height() + 2)
                                .hide();
                $presentHardware.find("li").click(function(){
                    $macInput.val($(this).data("mac"));
                });
            });
        </script>
    {% endif %}

    {% if visit_history %}
        <h1 style="margin: 10px 0;">История посещений умного дома</h1>
        <div class="content_item"><div class="content"><ul>
            {% for user_in, user_out in visit_history %}
                <li>
                    {{ user_in.created_at|datetime }} &mdash;
                    {% if user_out %}
                        {{ user_out.created_at|datetime }}
                    {% else %}
                        Настоящее время
                    {% endif %}
                </li>
            {% endfor %}
        </ul></div></div>
    {% endif %}
{% endblock %}
